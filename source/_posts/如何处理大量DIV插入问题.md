---
title: 如何处理大量DIV插入问题
date: 2019-07-22 16:43:46
tags:
  - HTML
  - DOM
  - Javascript
  - Event Loop
---

> &emsp;&emsp;讲真，这篇文章我写出来都有种文艺复兴的感觉；不过从解决问题的角度上看，一些处理问题的方案还是能综合应用到不同的实际场景中区的。

<escape><!-- more --></escape>

## 背景

&emsp;&emsp;最早其实是在一次分享会上听到了相关问题的讲解，近期又在一次面试中和面试官讨论了这个问题：**如何处理大量DIV插入问题？**。

&emsp;&emsp;那么本文就以这样一个DEMO来进行讨论：如何优化点击一个button往`container`容器中插入2W个`div`的场景。

### Let's go!

#### 方案一：憨憨插入

&emsp;&emsp;什么是憨憨插入呢？就是你直接操作DOM树，通过找到父亲节点然后根据要插入的DIV数量循环调用`appendChild`插入；这大概是刚接触前端的人才会选择的做法，这样的问题是什么呢？首先，我们每一次直接插入DIV都会导致重排发生页面重渲染，其次JS是单线程的，它与浏览器的渲染线程是互斥的，即当我们同步执行按钮回调时，页面渲染此时是被阻塞的，那么当这一个处理环节比较长，超过了我们所谓的通感时长时，用户就会明显感到卡顿，这肯定是不OK的。