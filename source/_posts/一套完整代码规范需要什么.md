---
title: ä¸€å¥—å®Œæ•´çš„ä»£ç è§„èŒƒéœ€è¦ä»€ä¹ˆ
date: 2021-06-08 11:27:16
tags:
  - å·¥ç¨‹åŒ–
  - ä»£ç è§„èŒƒ
  - EditorConfig
  - ESLint
  - Prettier
  - lint-staged
  - husky
---

&emsp;&emsp;ç®€å•æ¥è¯´å°±æ˜¯ä¸€ç³»åˆ—é…ç½®é¡¹çº¦æŸçš„é›†åˆï¼š`.editorconfig`â•`.eslintrc`â•`.prettierrc`â•`git hooks`ã€‚

<escape><!-- more --></escape>

### EditorConfig

&emsp;&emsp;æˆ‘ä»¬çŸ¥é“ä¸åŒçš„å¼€å‘äººå‘˜å¯¹ IDE çš„ä½¿ç”¨åå¥½éƒ½æœ‰å·®åˆ«ï¼Œä½†æ˜¯ä¸€äº›ç¼©è¿›ç±»çš„é…ç½®éƒ½æ˜¯å…±é€šçš„ï¼Œä¸€å¥—ä»£ç æˆ‘ä»¬è‚¯å®šä¸å¸Œæœ›åœ¨å¼€å‘ A é‚£é‡Œæ˜¯ 2 ä¸ªç©ºæ ¼çš„ tabï¼Œè·‘åˆ°å¼€å‘ B é‚£è¾¹å°±å˜æˆäº† 4 ä¸ªç©ºæ ¼çš„ tabã€‚ä¸€æ–¹é¢ä½ é…ç½®çš„`prettier`æˆ–è€…`eslint`å¯èƒ½ä¼š âš ï¸ï¼Œå¦ä¸€æ–¹é¢ git æ£€æµ‹ä¹Ÿä¼šè®¤ä¸ºæ˜¯ diffã€‚

&emsp;&emsp;æ‰€ä»¥æœ‰äº† EditorConfigï¼Œå®ƒé€šè¿‡åœ¨é¡¹ç›®ä¸­ç›´æ¥é…ç½®`.editorconfig`ï¼Œå¯ä»¥ä¿è¯**ç¼©è¿›æ–¹å¼ã€ç¼©è¿›é•¿åº¦ã€æ¢è¡Œã€ç¼–ç ç­‰**çš„ä¸€è‡´æ€§ã€‚

![](logo.png)

&emsp;&emsp;æ ¹æ®[EditorConfig å®˜æ–¹](https://editorconfig.org/)çš„è¯´æ³•ï¼Œå¤§éƒ¨åˆ† IDE æœ¬èº«å°±æ”¯æŒå¯¹`.editorconfig`é…ç½®æ–‡ä»¶çš„æ”¯æŒã€‚æˆ‘ä»¬ä»…éœ€åˆ›å»ºå¹¶ç¼–è¾‘æˆ‘ä»¬çš„è§„åˆ™å³å¯ã€‚

&emsp;&emsp;EditorConfig ä¼šè‡ªä¸Šè€Œä¸‹å¯»æ‰¾å¯¹åº”çš„`.editorconfig`é…ç½®ï¼Œæ‰€ä»¥ç†è®ºä¸Šä½ å¯ä»¥é…ç½®å¤šä¸ªï¼Œå¹¶ä¸”ç¦»å½“å‰ç›®å½•æ ‘æœ€è¿‘çš„ä¸€çº§é…ç½®æ–‡ä»¶å…·æœ‰æœ€é«˜çš„ä¼˜å…ˆçº§ã€‚

&emsp;&emsp;å½“ç„¶æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯åœ¨ä¸»å…¥å£å±‚çº§é…ç½®ä¸€ä¸ªç»Ÿä¸€çš„ã€‚å¦å¤–è¿™ä¸ªæ–‡ä»¶è¦ä¹ˆæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•è¦ä¹ˆåœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™`root=true`ã€‚

&emsp;&emsp;è‡³äºé…ç½®æ–¹å¼åœ¨å®˜ç½‘ä¸Šæœ‰ Example è¯´æ˜ï¼Œä¸è¿‡ä½œä¸º FE devï¼Œçœ‹ä¸‹ä¸šå†…çš„åº“å¯èƒ½æ›´ç›´è§‚ï¼Œå°±æ‹¿`jquery`çš„é…ç½®æ¥è¯´ï¼š

```javascript
# This file is for unifying the coding style for different editors and IDEs
# editorconfig.org

root = true

[*]
indent_style = tab
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[package.json]
indent_style = space
indent_size = 2
```

1. `indent_style`ç”¨æ¥è®¾ç½®ç¼©è¿›çš„ç±»åˆ«ï¼Œæœ‰`tab`å’Œ`space`ä¸¤ç§é€‰æ‹©ã€‚
2. `indent_size`æ˜¯å½“æˆ‘ä»¬é€‰æ‹©`indent_style = space`æ—¶ï¼Œæ‰é…ç½®è¯¥å±æ€§ï¼Œæè¿°çš„æ˜¯å•ä½ç¼©è¿›çš„åˆ—æ•°ã€‚
3. `tab_width`æ˜¯å½“æˆ‘ä»¬é€‰æ‹©`indent_style = tab`æ—¶å¯¹åº”çš„å•ä½ç¼©è¿›çš„åˆ—æ•°ã€‚
4. `end_of_line`ä¸ºæ¢è¡Œæ—¶é€‰æ‹©çš„æ¢è¡Œç¬¦ï¼Œæœ‰`lf`ã€`cr`ï¼Œ`crlf`ä¸‰ç§é€‰æ‹©ã€‚ä¸€èˆ¬å¼€æºçš„åº“éƒ½é€‰æ‹©`lf`ï¼Œlinuxã€os xï¼Œmax os ä½¿ç”¨`lf`ï¼Œwin ä½¿ç”¨`crlf`ã€‚ï¼ˆé€¼ä¹ä¸Šæœ‰è®¨è®ºè¯´`cr`åœ¨ linux ç±»ç³»ç»Ÿä¸‹é—®é¢˜å¾ˆå¤§ï¼Œä½†æ˜¯ win ä¸­ä¸ç”¨`cr`ä¸ä¼šæœ‰å¾ˆå¤§é—®é¢˜ï¼ŒemmğŸ¤·â€â™‚ï¸
5. `trim_trailing_whitespace`ç½®ä¸º`true`ï¼Œä¼šå°†æ¯è¡Œåé¢å¤šä½™çš„ç©ºæ ¼ç§»é™¤ï¼Œ`false`åˆ™ä¼šä¿ç•™ã€‚
6. `insert_final_newline`ç½®ä¸º`true`ï¼Œä¼šåœ¨ä¿å­˜æ–‡ä»¶ååœ¨æ–‡ä»¶æœ«å°¾æ–°å¢ä¸€ä¸ªç©ºç™½è¡Œï¼Œ`false`åˆ™ä¸ä¼šã€‚
7. `charset`ï¼Œå­—ç¬¦ç¼–ç ï¼Œé€šå¸¸ä½¿ç”¨`utf-8`ã€‚

&emsp;&emsp;ä»¥ä¸Šæ˜¯é…ç½®ï¼Œæœ¬äººä½¿ç”¨çš„ IDE æ˜¯ VS Codeï¼Œæˆ‘è¦æ€ä¹ˆä½¿è¿™äº›é…ç½®ç”Ÿæ•ˆå‘¢ï¼Ÿ

- `Extensions`å®‰è£…æ’ä»¶`EditorConfig for VS Code`æ’ä»¶ã€‚
- åœ¨å½“å‰æ–‡ä»¶é€‰å–å†…å®¹ï¼Œå¿«æ·æ ¼å¼åŒ–æ“ä½œ mac: `âŒ¥ + â‡§ + F`, win: `alt + shift + F`ã€‚

### ESLint

&emsp;&emsp;ä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ç¯‡å…³äº ESLint é…ç½®çš„æ–‡ç« ï¼Œè§[ã€Šå…³äº ESLintã€‹](https://chrisdeo.github.io/2019/08/22/%E5%85%B3%E4%BA%8EESLint/)ã€‚

&emsp;&emsp;ESLint æä¾›äº†ä¸€å¥—æ½œåœ¨é—®é¢˜å’Œå†™æ³•çš„çº é”™æœºåˆ¶ï¼Œå®ƒæ ¹æ®ä¸€äº›å®šåˆ¶é€»è¾‘ä¼šæä¾›å¼€å‘è€…å¯¹åº”çš„é”™è¯¯å’Œè­¦å‘Šã€‚

&emsp;&emsp;æˆ‘ä»¬ä¸€èˆ¬å¯ä»¥é€šè¿‡ CI ç”Ÿæˆä¸€ä»½åˆå§‹åŒ– ESLint æ–‡ä»¶ï¼š

- `npm i -g eslint`ï¼Œå®‰è£…å…¨å±€ CIï¼Œå¯èƒ½è¦ä½¿ç”¨`root`æƒé™ã€‚
- `eslint --init`æ ¹æ®å‘½ä»¤è¡Œæç¤ºï¼Œé€‰æ‹©æˆ‘ä»¬éœ€è¦çš„åˆå§‹åŒ–é…ç½®ã€‚

![](eslintInit.jpg)

&emsp;&emsp;æ¯”å¦‚æˆ‘æ ¹æ®æˆ‘åœ¨æµè§ˆå™¨ç¯å¢ƒç”Ÿæˆäº†ä¸€ä»½`json`æ ¼å¼çš„åˆå§‹é…ç½®æ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š

```json
{
  "env": {
    "browser": true,
    "es2021": true
  },
  "extends": ["eslint:recommended", "plugin:react/recommended"],
  "parserOptions": {
    "ecmaFeatures": {
      "jsx": true
    },
    "ecmaVersion": 12,
    "sourceType": "module"
  },
  "plugins": ["react"],
  "rules": {}
}
```

&emsp;&emsp;å¯ä»¥çœ‹åˆ°`env`å°±æ˜¯æˆ‘ä»¬æ‰€å¤„çš„ js å®¿ä¸»ç¯å¢ƒï¼›`extends`åˆ™ä¼šå»ç»§æ‰¿ç›¸å…³`eslint`çš„é…ç½®è§„åˆ™ï¼Œæ•°ç»„æ ¼å¼åé¢çš„é…ç½®é¡¹å†…çš„é‡å¤ç±»å‹è§„åˆ™ä¼šè¦†ç›–ä¹‹å‰çš„ï¼›`parserOptions`ä¸»è¦å‘Šè¯‰ç¼–è¯‘å™¨å°†æºä»£ç è½¬æˆä»€ä¹ˆå†…å®¹æ ¼å¼çš„`AST`è¿›è¡Œè§„åˆ™åˆ†æå’Œå¤„ç†ï¼›`plugins`å¯ä»¥ç†è§£ä¸ºè‡ªå®šä¹‰çš„ ESLint æ£€æµ‹ï¼Œé€šå¸¸æ˜¯ä¸€äº›æ¯”è¾ƒç»†èŠ‚çš„å®šåˆ¶åŒ–æ‰«æï¼Œå…¶ä¸­çš„æ’ä»¶ä¼šæŒ‚è½½åˆ°æ ¡éªŒç¯å¢ƒä¸­ï¼Œå¹¶åœ¨`rules`ä¸­æä¾›ç»†èŠ‚å¼€å…³æŒ‡å®šä½¿ç”¨ï¼›`rules`ä¸­è¿˜æ”¯æŒæˆ‘ä»¬é¢å¤–çš„å•æ¡æ£€æµ‹çš„å®šåˆ¶å¤„ç†ã€‚

#### Unexpected lexical declaration in case block(no-case-declarations)

&emsp;&emsp;åœ¨ä¸ªäººé¡¹ç›®æ‰§è¡Œè§„èŒƒæ—¶ï¼Œæœ‰ä¸ªå°æ’æ›²ï¼Œå³æŠ¥äº†`Unexpected lexical declaration in case block`çš„`error`ç±»æ ¡éªŒæç¤ºã€‚

&emsp;&emsp;å®šä½åå‘ç°æ˜¯**åœ¨`switch...case...`è¯­å¥ä¸­ï¼Œåˆ†æ”¯æ¡ä»¶ä»£ç å—ä¸­è¿›è¡Œäº†å˜é‡å£°æ˜ï¼Œä½†æœªä½¿ç”¨`{}`åŒ…è£¹è¯¥ä»£ç å—ã€‚**

&emsp;&emsp;è¿™æ ·æ“ä½œä¼šæœ‰æ½œåœ¨é£é™©ï¼Œå› ä¸ºåœ¨æ•´ä¸ª`switch...case...`ä¸­ï¼Œæˆ‘ä»¬çš„å˜é‡éƒ½å£°æ˜åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡å†…ï¼Œæ‰€ä»¥å¦‚æœä¸ç”¨`{}`åŒ…è£¹ï¼Œå¯¹ä¸€ä¸ªå˜é‡åçš„å£°æ˜ä¼šå¯¼è‡´é‡å¤å£°æ˜æŠ›é”™ï¼š`Uncaught SyntaxError: Identifier xxx has already been declared`ï¼Œä¹Ÿå°±æ„å‘³ç€ä¸åŒæ¡ä»¶åˆ†æ”¯éƒ½å¯èƒ½ä¼šé‡æ–°å¯¹å…¶è¿›è¡Œèµ‹å€¼ï¼Œäº§ç”Ÿå‰¯ä½œç”¨ã€‚

&emsp;&emsp;ä¸¾äº› ğŸŒ°ï¼š

```javascript
switch (1) {
  case 1:
    let foo = 1;
    break;
  case 2:
    let foo = 2;
    console.log(foo); // ä¼šæŠ¥é”™ï¼šUncaught SyntaxError: Identifier 'foo' has already been declared
    break;
}

switch (2) {
  case 1:
    function f() {
      console.log('???');
    }
    break;
  case 2:
    f(); // ä¼šè¾“å‡ºï¼š???
    break;
}
```

#### ä¸€äº›ä¾èµ–çš„æ’ä»¶

&emsp;&emsp;å¦‚æœä½¿ç”¨äº†`css-modules`ï¼Œå¹¶å¸Œæœ›å¾—åˆ°ä¸€äº›æ˜¯å¦å¼•ç”¨å…¶ä¸­æ ·å¼çš„æ£€æµ‹ï¼Œéœ€è¦å®‰è£…æ’ä»¶`eslint-plugin-css-modules`ã€‚

### Prettier

&emsp;&emsp;å‰é¢æˆ‘ä»¬è¿›è¡Œäº† EditorConfig å’Œ ESLint çš„è®¨è®ºï¼Œå®ƒä»¬çš„èŒèƒ½åˆ†åˆ«å¯¹åº”**IDE ç¼–è¾‘é£æ ¼è§„èŒƒ**å’Œ**ä»£ç é—®é¢˜åŠé£æ ¼çš„æ£€æµ‹è§„èŒƒ**ã€‚

&emsp;&emsp;è€Œ`Prettier`ï¼Œ**å®ƒä¸å…·å¤‡ä»»ä½•ä»£ç è§„èŒƒçš„çº é”™èƒ½åŠ›**ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªé£æ ¼ä¸Šçš„ç»Ÿä¸€å·¥å…·ï¼Œè¿™é‡Œçš„é£æ ¼æŒ‡çš„æ˜¯ç±»ä¼¼æ¯è¡Œä»£ç ç»“å°¾æ˜¯å¦éœ€è¦`;`ã€å­—ç¬¦ä¸²ä½¿ç”¨å•å¼•å·è¿˜æ˜¯åŒå¼•å·åŒ…è£¹ï¼Œæœ€åçš„å˜é‡å¼•å…¥æˆ–è€…å£°æ˜æ˜¯å¦è¡¥`,`ç­‰é—®é¢˜ã€‚

&emsp;&emsp;æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é¡¹ç›®ä¸‹åˆ›å»º`.prettierrc`æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œé…ç½®æ–‡æ¡£è§[Options](https://prettier.io/docs/en/options.html)ï¼š

```javascript
{
    "semi": false,
    "useTabs": false,
    "singleQuote": true,
    "trailingComma": "es5"
}
```

&emsp;&emsp;`package.json`ä¸‹ä¹Ÿè¦åœ¨`devDependencies`ä¾èµ–ä¸‹å®‰è£…å¯¹åº” Prettier ä¾èµ–ï¼š

```javascript
npm i -D prettier eslint-plugin-prettier eslint-config-prettier
```

&emsp;&emsp;å®‰è£…åï¼Œè¿˜è¦åœ¨ä¹‹å‰çš„`.eslintrc.json`ä¸‹çš„`plugins`æ•°ç»„ä¸­æ·»åŠ `prettier`ï¼Œæ³¨æ„`prettier`è¦æ”¾åœ¨æ’ä»¶çš„æœ€åä¸€ä¸ªã€‚

&emsp;&emsp;ç„¶åæˆ‘ä»¬è¿˜è¦åƒå‰æ–‡ä¸­æè¿°çš„ï¼Œåœ¨`rules`ä¸‹æ‰‹åŠ¨æ¿€æ´»`prettier`æ’ä»¶ä¸­çš„é…ç½®é¡¹ï¼Œ`error`è¡¨ç¤ºè¯¥æ’ä»¶è§„åˆ™å‘½ä¸­æ—¶ä¼šåœ¨æ§åˆ¶å°æŠ¥é”™ï¼š

```javascript
{
    "extends": [
        "prettier"
    ],
    "plugins": ["prettier"],
    "rules": {
        "prettier/prettier": "error",
    }
}
```

&emsp;&emsp;P.S.æ­¤å¤„çš„å†™æ³•å¯ä»¥çœç•¥å¹¶ç®€åŒ–æˆ`extends`ä¸­çš„ä¸€å¥ï¼š

```javascript
{
    "extends": ["plugin:prettier/recommended"]
}
```

&emsp;&emsp;æœ€ååŒæ ·è¦åœ¨`Extensions`ä¸­å®‰è£…`Prettier - Code formatter`æ’ä»¶ã€‚


### Git Hooks

&emsp;&emsp;åŸç†æ˜¯åˆ©ç”¨gitçš„hooksèƒ½åŠ›ï¼Œåœ¨æäº¤å‰åº”ç”¨æˆ‘ä»¬çš„æ ¡éªŒè§„åˆ™ã€‚

&emsp;&emsp;æ¯”è¾ƒä¸»æµçš„åšæ³•æ˜¯ä½¿ç”¨`husky`â•`lint-staged`ï¼Œå‰è€…ä¼šå°†å…¶é…ç½®é›†æˆåˆ°git hooksä¸‹çš„`pre-commit`é˜¶æ®µå¹¶åœ¨æäº¤å‰æ ¡éªŒã€‚åè€…åˆ™æ˜¯é™åˆ¶åº”ç”¨èŒƒå›´ã€‚

&emsp;&emsp;å¯¹äºä¸€ä¸ªå¤§å‹é¡¹ç›®è€Œè¨€ï¼Œä»£ç é‡æ˜¯éå¸¸å·¨å¤§çš„ï¼Œå¦‚æœæˆ‘ä»¬è´¸ç„¶ä½¿ç”¨å‰æ–‡ä¸­çš„`prettier`ä¹‹ç±»çš„è¿›è¡Œæ ¼å¼åŒ–ï¼Œä¼šé€ æˆå¤§é‡çš„æ–‡ä»¶å˜æ›´ï¼Œè¿™æ ·çš„`commit`ä¼šå¼•èµ·å¾ˆå¤šä¸å¿…è¦çš„éº»çƒ¦ï¼ˆå¦‚ä¿®æ”¹äº†å†å²æäº¤äººä¿¡æ¯ã€é€ æˆcode reviewäººå‘˜é¢å¤–çš„å·¥ä½œè´Ÿæ‹…ç­‰ï¼‰ï¼Œæ‰€ä»¥é€šè¿‡`lint-staged`ä¼šä½¿è§„åˆ™åªåœ¨æˆ‘ä»¬æœ€æ–°çš„æäº¤å†…å®¹å†…ç”Ÿæ•ˆï¼Œå› æ­¤ç¼©å°äº†å½±å“èŒƒå›´ã€‚

&emsp;&emsp;è¦åº”ç”¨è‚¯å®šå¾—å…ˆè¿›è¡Œå®‰è£…ï¼š

```javascript
npm i -D husky lint-staged
```

&emsp;&emsp;åœ¨`package.json`ä¸­é…ç½®ï¼š

```javascript
"husky": {
    "hooks": {
      "pre-commit": "lint-staged"
    }
},
"lint-staged": {
    "src/**/*.js": [
      "eslint --fix",
      "prettier --write",
      "git add"
    ]
},
```

&emsp;&emsp;æ­¤æ—¶å½“æˆ‘ä»¬è¿›è¡Œ`git commit -m "xxx"`ä»£ç æäº¤æ—¶ï¼Œå°±ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºå¤„ç†ä»£ç å†…å®¹ï¼š

1. æ£€è§†æ‰€æœ‰æ›´æ”¹çš„ä»£ç å†…å®¹ï¼Œæ­¤å¤„åªè¿›è¡Œ`js`åç¼€æ ¼å¼å†…å®¹æ‰«æã€‚
2. å…ˆä½¿ç”¨`eslint`è¿›è¡Œä¿®å¤ã€‚
3. ä½¿ç”¨`prettier`è¿›è¡Œä»£ç é£æ ¼ç»Ÿä¸€ã€‚
4. å°†å˜åŠ¨å†…å®¹é‡æ–°åº”ç”¨è¿›ç¼“å†²åŒºã€‚

### Web Hooks

&emsp;&emsp;å®é™…ä¸Šå‰æ–‡ä¸­è®¨è®ºçš„æ ¡éªŒè§„åˆ™éƒ½æ˜¯åœ¨å¼€å‘è€…æœ¬åœ°é…ç½®çš„ï¼Œæœ‰å¾ˆå¤šæ–¹å¼å¯ä»¥ç»•å¼€ï¼ˆ`--no-verify`ã€å‰”é™¤git hooksç­‰ï¼‰ã€‚

&emsp;&emsp;å¦‚æœæœ‰å¼ºè¦æ±‚è§„èŒƒï¼Œå¯ä»¥å°†è¿™äº›è§„åˆ™ä¸Šåˆ°æœåŠ¡ç«¯ã€‚é€šè¿‡é…ç½®web hooksï¼Œå¯ä»¥åœ¨æœåŠ¡ç«¯æ‹’ç»æˆ‘ä»¬çš„ä¸ç¬¦åˆè§„èŒƒçš„æäº¤å†…å®¹ã€‚